<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .welcome-message {
            margin-bottom: 2rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
        }
        input, select, textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .variable-list {
            margin-top: 2rem;
        }
        .variable-item {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        .validation-rules {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .discord-id-section {
            margin: 2rem 0;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .error-message {
            color: #dc3545;
            margin-top: 0.5rem;
            display: none;
        }
        .api-key-section {
            margin: 2rem 0;
            padding: 1rem;
            background-color: #e9f7fe;
            border-radius: 4px;
            border-left: 4px solid #0066cc;
        }
        .api-key-display {
            font-family: monospace;
            padding: 0.5rem;
            background: #f1f1f1;
            border-radius: 4px;
            margin: 0.5rem 0;
            position: relative;
        }
        .copy-button {
            position: absolute;
            right: 5px;
            top: 5px;
            padding: 2px 8px;
            font-size: 12px;
            background: #ddd;
            color: #333;
        }
        .section-title {
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        .preview-section {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px dashed #ccc;
        }
        .tab-container {
            margin-top: 1rem;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: #555;
            cursor: pointer;
            margin-right: 1rem;
        }
        .tab-button.active {
            border-bottom: 2px solid #007bff;
            color: #007bff;
        }
        .tab-content {
            padding: 1rem 0;
        }
        .tab-panel {
            display: none;
        }
        .tab-panel.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Dashboard</h1>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="welcome-message">
            <h2>AI Form Assistant Dashboard</h2>
            <p>This platform allows you to replace traditional web forms with a conversational AI assistant that collects information via Discord.</p>
        </div>

        <div class="api-key-section">
            <h3>Your API Key</h3>
            <p>Use this API key to integrate the Discord bot with your website.</p>
            <div class="api-key-display">
                <span id="apiKeyValue">••••••••••••••••••••••••••</span>
                <button class="copy-button" onclick="copyApiKey()">Copy</button>
            </div>
            <button onclick="generateApiKey()">Generate New API Key</button>
        </div>

        <div class="discord-id-section">
            <div class="form-group">
                <label for="discordUserId">Your Discord User ID</label>
                <input type="text" id="discordUserId" placeholder="Enter your Discord User ID" required>
                <p class="error-message" id="discordUserIdError">Please enter a valid Discord User ID</p>
            </div>
            <button id="startCollection" class="start-button">Start Collection</button>
        </div>
        
        <div class="content">
            <h2 class="section-title">Form Configuration</h2>

            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="openTab(event, 'naturalLanguage')">Natural Language</button>
                    <button class="tab-button" onclick="openTab(event, 'manualConfig')">Manual Configuration</button>
                </div>

                <div id="naturalLanguage" class="tab-panel active">
                    <div class="form-group">
                        <label for="formDescription">Describe Your Form Requirements</label>
                        <textarea id="formDescription" placeholder="Example: I need to collect the user's full name, email address, phone number, and their preferred contact method (phone or email). The email must be valid and the phone number should be in international format." rows="5"></textarea>
                    </div>
                    <button onclick="generateFormFromDescription()">Generate Form Structure</button>
                    
                    <div class="preview-section" id="formPreview">
                        <h3>AI Interpretation</h3>
                        <p>Click the button above to see how the AI will interpret your requirements.</p>
                    </div>
                </div>

                <div id="manualConfig" class="tab-panel">
                    <h3>Current Variables</h3>
                    <div id="variableList" class="variable-list">
                        <!-- Variables will be loaded here -->
                    </div>
                    
                    <h3>Add New Variable</h3>
                    <form id="variableForm" class="form-group">
                        <div class="form-group">
                            <label for="name">Variable Name</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="prompt">Prompt</label>
                            <input type="text" id="prompt" name="prompt" required>
                        </div>
                        <div class="form-group">
                            <label for="type">Type</label>
                            <select id="type" name="type" required>
                                <option value="string">String</option>
                                <option value="email">Email</option>
                                <option value="number">Number</option>
                                <option value="phone">Phone Number</option>
                                <option value="date">Date</option>
                                <option value="choice">Choice</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="max_length">Max Length</label>
                            <input type="number" id="max_length" name="max_length">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="required" name="required">
                                Required
                            </label>
                        </div>
                        <button type="submit">Add Variable</button>
                    </form>
                </div>
            </div>

            <h2 class="section-title">Integration Guide</h2>
            <div class="form-group">
                <p>Add this code to your website to integrate with our Discord bot:</p>
                <div class="code-preview">
                <pre><code>// Add a button to your form page
&lt;button id="discordForm"&gt;Fill via Discord&lt;/button&gt;

// Add this JavaScript to your page
&lt;script&gt;
  document.getElementById('discordForm').addEventListener('click', function() {
    const discordId = prompt("Please enter your Discord User ID");
    if (discordId) {
      fetch('https://your-server.com/api/start-form', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer YOUR_API_KEY'
        },
        body: JSON.stringify({
          discordUserId: discordId,
          formId: 'your-form-id'
        })
      })
      .then(response => response.json())
      .then(data => {
        alert("Check your Discord for a message from our bot!");
      });
    }
  });
&lt;/script&gt;</code></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Key Management
        let currentApiKey = '';

        function generateApiKey() {
            // In a real implementation, this would be a server call
            currentApiKey = 'key_' + Math.random().toString(36).substr(2, 20);
            document.getElementById('apiKeyValue').textContent = currentApiKey;
        }

        function copyApiKey() {
            if (currentApiKey) {
                navigator.clipboard.writeText(currentApiKey)
                    .then(() => alert('API key copied to clipboard!'))
                    .catch(err => console.error('Failed to copy:', err));
            } else {
                alert('Please generate an API key first');
            }
        }

        // Tab management
        function openTab(evt, tabName) {
            const tabButtons = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].className = tabButtons[i].className.replace(" active", "");
            }

            const tabPanels = document.getElementsByClassName("tab-panel");
            for (let i = 0; i < tabPanels.length; i++) {
                tabPanels[i].className = tabPanels[i].className.replace(" active", "");
            }

            document.getElementById(tabName).className += " active";
            evt.currentTarget.className += " active";
        }

        // Generate form structure from natural language description
        function generateFormFromDescription() {
            const description = document.getElementById('formDescription').value;
            if (!description) {
                alert('Please enter a description of your form requirements');
                return;
            }

            // In a real implementation, this would call the Mistral API
            // For now, we'll show a mockup of what the AI might interpret
            const mockInterpretation = {
                fields: [
                    { name: 'fullName', type: 'string', prompt: "What's your full name?", required: true },
                    { name: 'email', type: 'email', prompt: "What's your email address?", required: true },
                    { name: 'phone', type: 'phone', prompt: "What's your phone number with country code?", required: true },
                    { name: 'preferredContact', type: 'choice', prompt: "Do you prefer to be contacted by phone or email?", options: ['Phone', 'Email'], required: true }
                ]
            };

            displayFormPreview(mockInterpretation);
        }

        function displayFormPreview(interpretation) {
            const previewElement = document.getElementById('formPreview');
            let html = '<h3>AI Interpretation</h3>';
            html += '<p>Here\'s how the AI will collect this information:</p>';
            html += '<ul>';
            
            interpretation.fields.forEach(field => {
                html += `<li><strong>${field.name}</strong>: ${field.prompt} <em>(${field.type}${field.required ? ', required' : ''})</em></li>`;
            });
            
            html += '</ul>';
            html += '<p>The AI will validate responses and follow up if any information is incorrect or incomplete.</p>';
            
            previewElement.innerHTML = html;
        }

        // Add event listener for Discord ID collection
        document.getElementById('startCollection').addEventListener('click', function() {
            const discordId = document.getElementById('discordUserId').value;
            if (!discordId) {
                document.getElementById('discordUserIdError').style.display = 'block';
                return;
            }
            
            document.getElementById('discordUserIdError').style.display = 'none';
            alert(`A message will be sent to Discord user ${discordId} to collect information.`);
            // In a real implementation, this would trigger the Discord bot
        });

        // Initialize with an API key
        generateApiKey();
    </script>
</body>
</html>
